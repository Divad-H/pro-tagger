<UserControl x:Class="ProTagger.Repository.RepositoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:logview="clr-namespace:ProTagger.Repository.GitLog"
             xmlns:diffview="clr-namespace:ProTagger.Repository.Diff"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal">
            <ToggleButton x:Name="PopupButton"
                          IsChecked="{Binding ElementName=Popup, Path=IsOpen}"
                          Width="20"
                          Height="20">
                <ToggleButton.Content>
                    <Canvas>
                        <Path Canvas.Left="-7.5" Canvas.Top="-8" Fill="Black" Width="11" Height="14" Stretch="UniformToFill" Data="m 556.28569,312.3622 c -70.625,0 -128,57.344 -128,128 0,47.219 25.875,88.062 64,110.281 l -0.85715,47.14756 -255.14285,80.24058 0,-255.38814 c 38.156,-22.219 64,-63.062 64,-110.281 0,-70.656 -57.344,-128 -128,-128 -70.656,0 -128.000004,57.344 -128.000004,128 0,47.219 25.844,88.062 64.000004,110.281 l 0,372.32614 c -38.156004,22.188 -64.000004,63 -64.000004,110.25 0,70.625 57.344004,127.99996 128.000004,127.99996 70.656,0 128,-57.37496 128,-127.99996 0,-33.5 -13.188,-63.75 -34.25,-86.625 L 619.99997,680.79076 620.28569,550.6432 c 38.125,-22.219 64,-63.062 64,-110.281 0,-70.656 -57.375,-128 -128,-128 z m -384,-64 c 35.406,0 64,28.594 64,64 0,35.406 -28.594,64 -64,64 -35.406,0 -64,-28.594 -64,-64 0,-35.406 28.594,-64 64,-64 z m 0,720.85714 c -35.406,0 -64,-28.625 -64,-64 0,-35.312 28.594,-64 64,-64 35.406,0 64,28.688 64,64 0,35.375 -28.594,64 -64,64 z m 384,-464.85714 c -35.375,0 -64,-28.594 -64,-64 0,-35.406 28.625,-64 64,-64 35.375,0 64,28.594 64,64 0,35.406 -28.625,64 -64,64 z" />
                        <TextBlock Text="⯆" Canvas.Left="-1" Canvas.Top="-4.5"/>
                    </Canvas>
                </ToggleButton.Content>
                <ToggleButton.Style>
                    <Style TargetType="ToggleButton" BasedOn="{StaticResource {x:Type ToggleButton}}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsOpen, ElementName=Popup}" Value="True">
                                <Setter Property="IsEnabled" Value="False" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ToggleButton.Style>
            </ToggleButton>

            <Popup x:Name="Popup" 
                   StaysOpen="False"
                   PlacementTarget="{Binding ElementName=PopupButton}" 
                   Placement="Bottom"
                   Width="200">
                <ItemsControl ItemsSource="{Binding Branches.Value}" Background="{StaticResource br_light}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <CheckBox Content="{Binding PrettyName}" 
                                      IsChecked="{Binding Selected.Value}" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Popup>
            <Button Command="{Binding RefreshCommand}"
                    Content="&#xE72C;"
                    FontFamily="Segoe MDL2 Assets"
                    FontWeight="Bold" Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}" />
        </StackPanel>

        <logview:GitLogView Grid.Row="1" DataContext="{Binding Graph}"/>
        <Border Grid.Row="2" Background="{StaticResource br_blue}" Height="2"/>
        <diffview:DiffView Grid.Row="3" DataContext="{Binding Diff}"/>
    </Grid>
</UserControl>
